#!/usr/bin/env bash
#
# @file Install brew formulae.

set -e

readonly SCRIPT_DIR="$(dirname "$0")"
readonly DOTFILES="${DOTFILES:-$(dirname "$SCRIPT_DIR")}"

source "${DOTFILES}/shell/utilities.sh"


#
# Install forumulae used for system administration on a Mac system.
#
# usage: install_core_formulae
#
install_core_formulae() {
  dot::info "Installing essential formulae …"

  brew tap homebrew/services

  brew install bash bash-completion@2
  brew install tmux

  brew install coreutils
  brew install curl
  brew install grep
  brew install rsync
  brew install wget

  brew install ack
  brew install ripgrep
  brew install tree
}

#
# Install formulae of choise used during Web Development.
#
# usage: install_web_formulae
#
install_web_formulae() {
  dot::info "Installing web formulae …"

  brew tap homebrew/php

  brew install neovim
  brew install python3
  brew install --HEAD universal-ctags/universal-ctags/universal-ctags

  brew install git
  brew install icdiff diff-so-fancy

  brew install httpd
  brew install php71 --with-httpd --with-homebrew-curl
  brew install php71-xdebug
  brew install composer
  brew install php-code-sniffer phpmd
  brew install psysh
  brew install adminer
  brew install mariadb

  brew install yarn --without-node
  brew install tidy-html5
  brew install shellcheck
}

#
# Install additional php packages.
#
# usage: install_php_packages
#
install_php_packages() {
  dot::info "Installing php packages …"

  brew tap homebrew/php

  brew install drush
  brew install drupalconsole
  brew install wp-cli
}

#
# Install shell utilities using Homebrew the missing package manager for macOS.
#
main() {
  if ! dot::command_exists "brew"; then
    dot::exit "Cannot find homwbrew command"
  fi

  local profile="${1:-minimal}"

  case "${profile}" in
    full)
      install_core_formulae
      install_web_formulae
      install_php_packages
      ;;
    *)
      install_core_formulae
      ;;
  esac
}

main "$@"
