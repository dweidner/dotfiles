#!/usr/bin/env bash
#
# @file Install Node Version Manager.

set -e

readonly SCRIPT_DIR="$(dirname "$0")"
readonly DOTFILES="${DOTFILES:-$(dirname "$SCRIPT_DIR")}"

source "${DOTFILES}/shell/utilities.sh"


NVM_DIR="${1:-$HOME/.local/share/nvm}"
NVM_VERSION="${2:-latest}"

dot::info "Installing nvm …"

git clone "https://github.com/creationix/nvm.git" "$NVM_DIR" || {
  dot::exit "Cannot checkout nvm repository"
}

cd "$NVM_DIR"

if [[ "$NVM_VERSION" = "latest" ]]; then
  NVM_VERSION=$(git describe --abbrev=0 --tags --match "v[0-9]*" origin)
fi

git checkout "$NVM_VERSION" || {
  dot::exit "Cannot switch to NVM version [$NVM_VERSION]"
}

dot::info "Installing latest node version …"

source "$NVM_DIR/nvm.sh"
nvm install --lts
