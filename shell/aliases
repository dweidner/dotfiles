# shell/aliases

# -----------------------------------------------
# Table of Contents
# -----------------------------------------------
# 1. System Aliases
# 2. LS: List Directory Contents
# 3. GREP: File Pattern Searcher
# 4. RSYNC: File-Copying Tool
# 5. System-specific Aliases
# -----------------------------------------------


# 1. System Aliases ----------------------------- {{{1

alias sudo="sudo "             # Allow aliases to be used with sudo
alias plz='sudo !!'            # Run the last command as root
alias map="xargs -n1"          # Intuitive map function
alias reload='exec $SHELL -l'  # Reload the shell

alias ..="cd .."               # Switch to the parent directory
alias cd..='cd ..'             # Correct missing space

alias md="mkdir -p"            # Create intermediate directories
alias rd="rmdir"               # Remove a directory

alias pu="pushd"               # Push a directory to the stack
alias po="popd"                # Remove the last directory from the stack

alias g="git"                  # Alias for the `stupid content tracker`
alias e="$EDITOR"              # Open a file in the default editor
alias o="$BROWSER"             # Open a file in the default browser


# 2. LS: List Directory Contents ---------------- {{{1

# Test whether the ls supports a given option ($1)
ls_supports() {
  command "${LS_BINARY:-ls}" "$@" >/dev/null 2>&1
}

# Prefer GNU `ls` on OSX which allows the use of ~/.dircolors
if gls >/dev/null 2>&1; then
  LS_BINARY="gls"
fi

# Collect options passed to the ls command
typeset -a ls_options

# Distinguish between BSD and GNU ls and add the appropriate option
if ls_supports --color=auto; then
  ls_options+=( --color=auto )
elif ls_supports -G; then
  ls_options+=( -G )
fi

alias ls="command ${LS_BINARY:-ls} ${ls_options[*]}"

alias ll="ls -lhF"  # Human readable sizes.
alias la="ll -A"    # Human readable sizes, hidden files.
alias lt="ll -tr"   # By date, most recent last.
alias lu="lt -u"    # By date, most recent last, show access time.
alias lc="lt -c"    # By date, most recent last, show change time.
alias lx="ll -XB"   # By extension (GNU only).
alias lz="ll -Sr"   # By size, largest last.


# 3. GREP: File Pattern Searcher ---------------- {{{1

# Test whether grep supports a given option ($1)
grep_supports() {
  grep "$1" "?" >/dev/null 2>&1 <(echo "?" 2>&1)
}

# Collect options passed to the grep command
typeset -a grep_options

# Test for color support and add the option to the collection
if grep_supports --color=auto; then
  grep_options+=( --color=auto )
fi

# Enable colored output for the grep command if supported
if [[ "${#grep_options[@]}" -ne 0 ]]; then
  alias grep="grep ${grep_options[*]}"
  alias fgrep="fgrep ${grep_options[*]}"
  alias egrep="egrep ${grep_options[*]}"
fi


# 4. RSYNC: File-Copying Tool ------------------- {{{1

# Test whether rsync supports a certain option ($1)
rsync_supports() {
  grep -q -- "$1" <(rsync --help 2>&1)
}

# Collect options passed to the custom rsync alias
typeset -a rsync_options

# Enable recursion and preserve permissions, (sym)links, time, group and owner
rsync_options+=( --archive --hard-links )

# Reduce the amount of data being transmitted
rsync_options+=( --compress )

# Avoid crossing a filesystem boundary when recursing
rsync_options+=( --one-file-system )

# Increase verbosity of rsync
rsync_options+=( --verbose --progress --human-readable )

# Preserve extended attributes if supported (since 2.6.8)
if rsync_supports --xattrs; then
  rsync_options+=( --acls --xattrs )
fi

# Preserve Mac specific fileflags/chflags
if [[ "$OSTYPE" == darwin* ]]; then
  if rsync_supports --fileflags; then
    rsync_options+=( --crtimes --fileflags --protect-decmpfs --force-change )
  fi
fi

# Creata rsync aliases for frequently used argument combinations
alias rsynccp="rsync ${rsync_options[*]}"
alias rsyncmv="rsynccp --remove-source-files"
alias rsyncup="rsynccp --update"
alias rsyncud="rsynccp --update --delete"


# 5. System-specific Aliases -------------------- {{{1

case "$OSTYPE" in

  # Mac OSX --------------------------- {{{2
  darwin*)
    alias cdf='cd "$(pfd)"'
    alias pushdf='pushd "$(pfd)"'

    alias finder="open -a Finder"
    alias chrome="open -a Google\ Chrome"
    alias firefox="open -a Firefox"
    alias safari="open -a Safari"

    alias hide='chflags hidden'
    alias unhide='chflags nohidden'

    alias cask="brew cask"
    alias pubkey="more ~/.ssh/id_rsa.pub | pbcopy"
    alias cleanup="find . -type f -name .DS_Store -ls -delete"
    alias emptytrash="sudo rm -rfv /Volumes/*/.Trashes; sudo rm -rfv ~/.Trash; sudo rm -rfv /private/var/log/asl/*.asl"
  ;; # }}}2

esac


# vim:syntax=sh:foldmethod=marker:foldlevel=2
