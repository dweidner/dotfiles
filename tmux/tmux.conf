# tmux.conf                                                               ><>°
#
# -----------------------------------------------------------------------
# Table of Contents
# -----------------------------------------------------------------------
# 1. Environment settings
# 2. Display settings
# 3. Mouse support
# 4. Keybindings
# 5. System clipboard
# 6. Statusline
# 7. Tmux Plugin Manager
# -----------------------------------------------------------------------


# (1) Environment settings ---------------------------------------------- {{{1

# Enable focus events for terminals that support them
set-option -g focus-events on

# Increase scrollback buffer size (default: 2000)
set-option -g history-limit 10000

# Run tmux in vi mode
set-option -g @shell_mode 'vi'

# Improve color support
set-option -sa terminal-overrides ",*-256col*:Tc"


# (2) Display settings -------------------------------------------------- {{{1

# Customize the window titles
set-option -g set-titles on
set-option -g set-titles-string "#{pane_index}:#{window_name} in #{session_name} on #{host}"

# By default windows are limited to the size of the smallest client
set-option -g aggressive-resize on

# Check for activity in the current window
set-option -g visual-activity off
set-window-option -g monitor-activity off

# Start counting from 1
set-option -g base-index 1
set-window-option -g pane-base-index 1

# Update window index and avoid gaps
set-option -g renumber-windows on


# (3) Mouse support ----------------------------------------------------- {{{1

# Enable the mouse. Shame on me...
set-option -g mouse on

# Improve mouse wheel behavior @see {@link https://git.io/vFMDd|Mouse scrolling in tmux 2.1}
bind-key -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"

# Select pane with a click on the scroll wheel
bind-key -n WheelDownPane select-pane -t= \; send-keys -M


# (4) Keybindings ------------------------------------------------------- {{{1

# Eliminate the delay when switching vim modes (default: 500)
set-option -s escape-time 0

# Change tmux prefix to Ctrl+Space
set-option -g prefix C-space

# Pressing `prefix + prefix` sends <prefix> to the shell
bind-key C-Space send-prefix

# Switch easily between windows
bind-key Space last-window

# Split the current pane vertically/horizontally
bind-key C-v split-window -h
bind-key C-s split-window -v

# Navigate between panes
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Resize the currently active pane
bind-key H resize-pane -L 4
bind-key J resize-pane -D 4
bind-key K resize-pane -U 4
bind-key L resize-pane -R 4

# Switch between layouts (main-horizontal/main-vertical)
bind-key - run-shell "tmux set-window-option main-pane-height $(( $(tmux display -p '#{window_height}') / 3 * 2 )); tmux select-layout main-horizontal"
bind-key | run-shell "tmux set-window-option main-pane-width $(( $(tmux display -p '#{window_width}') / 3 * 2 )); tmux select-layout main-vertical"

# Start new windows in the directory of the current pane
bind-key c new-window -c "#{pane_current_path}"

# Move the current window to the next/previous position
bind-key -r < swap-window -t -1
bind-key -r > swap-window -t +1

# Reload configuration
bind-key r source-file "${XDG_CONFIG_HOME}/tmux/tmux.conf" \; display-message "Sourced tmux configuration file"

# Bring back clear-screen/kill-line under tmux prefix
bind-key C-l send "C-l"
bind-key C-k send "C-k"


# (5) System clipboard -------------------------------------------------- {{{1

# Set default command used for new windows. Fixes the clipboard on macOS.
if-shell "type reattach-to-user-namespace >/dev/null 2>&1" \
  "set-option -g default-command 'reattach-to-user-namespace -l ${SHELL}'" \
  "set-option -g default-command ${SHELL}"


# (6) Statusline -------------------------------------------------------- {{{1

# Move the status line to the top
set-option -g status-position top

# Assign custom contents to the statusline columns
set-option -g status-justify left
set-option -g status-left "#[fg=colour250]⋮#[fg=default] "
set-option -g status-right " #{prefix_highlight} #[fg=colour246]#{session_name}#[fg=default] "

# Customize the title of the individual windows
set-window-option -g window-status-format "#[fg=colour250]#I:#[fg=colour246]#{window_name}#[fg=colour250]#{window_flags} ⋮#[fg=default]"
set-window-option -g window-status-current-format "#[fg=colour250]#I:#[fg=default]#{window_name}#[fg=colour250]#{window_flags} ⋮#[fg=default]"


# (7) Tmux Plugin Manager ----------------------------------------------- {{{1

# Customize the target destination of plugins installed via tpm
set-environment -g TMUX_PLUGIN_MANAGER_PATH "${XDG_DATA_HOME}/tmux/plugins"

# Customize the color of the tmux status line
set-option -g @theme "one"
set-option -g @theme-background "light"

# Select a list of plugins to install via the plugin manager
set-option -g @tpm_plugins '\
  tmux-plugins/tpm \
  tmux-plugins/tmux-prefix-highlight \
  tmux-plugins/tmux-sessionist \
  tmux-plugins/tmux-yank \
  dweidner/tmux-theme \
'

# Install the plugin manager if it is not already installed
if-shell "[[ ! -d ${XDG_DATA_HOME}/tmux/plugins/tpm ]]" \
  "run-shell 'git clone https://github.com/tmux-plugins/tpm ${XDG_DATA_HOME}/tmux/plugins/tpm && ${XDG_DATA_HOME}/tmux/plugins/tpm/bin/install_plugins'"

# Load the plugins into the current environment
run-shell "${XDG_DATA_HOME}/tmux/plugins/tpm/tpm"


# vim:foldmethod=marker:foldlevel=1
